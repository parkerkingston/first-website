<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pong</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #f0f0f0;
        }
        #gameContainer {
            width: 400px;
            height: 600px;
            background: #000;
            position: relative;
            overflow: hidden;
            touch-action: none;
        }
        #ball {
            width: 15px;
            height: 15px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            left: 192.5px;
            top: 20px;
        }
        #paddle {
            width: 80px;
            height: 10px;
            background: #fff;
            position: absolute;
            bottom: 20px;
            left: 160px;
        }
        #scoreDisplay, #speedDisplay, #highScoreDisplay {
            position: absolute;
            color: #fff;
            font: 16px Arial, sans-serif;
        }
        #scoreDisplay { top: 10px; left: 10px; }
        #speedDisplay { top: 30px; left: 10px; }
        #highScoreDisplay { top: 10px; right: 10px; }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="ball"></div>
        <div id="paddle"></div>
        <div id="scoreDisplay">Score: 0</div>
        <div id="speedDisplay">Speed: 1.0</div>
        <div id="highScoreDisplay">High Score: 0</div>
    </div>

    <script>
        const game = document.getElementById('gameContainer');
        const ball = document.getElementById('ball');
        const paddle = document.getElementById('paddle');
        const displays = {
            score: document.getElementById('scoreDisplay'),
            speed: document.getElementById('speedDisplay'),
            high: document.getElementById('highScoreDisplay')
        };

        let ballX = 192.5, ballY = 20, ballSpeedX = 1, ballSpeedY = 1;
        let paddleX = 160, score = 0, highScore = parseInt(document.cookie.split('; ')
            .find(row => row.startsWith('highScore='))?.split('=')[1]) || 0;
        const speedScale = 2, baseSpeed = 1;

        displays.high.textContent = `High Score: ${highScore}`;

        // Drag handling
        let isDragging = false;
        function movePaddle(e) {
            const source = e.touches?.[0] || e;
            if (!source.clientX) return; // Skip if no valid coordinates
            paddleX = Math.max(0, Math.min(source.clientX - game.getBoundingClientRect().left - 40, 320));
            paddle.style.left = `${paddleX}px`;
        }

        game.addEventListener('mousedown', e => { isDragging = true; movePaddle(e); });
        game.addEventListener('mousemove', e => isDragging && movePaddle(e));
        document.addEventListener('mouseup', () => isDragging = false);
        game.addEventListener('touchstart', e => { isDragging = true; movePaddle(e); e.preventDefault(); });
        game.addEventListener('touchmove', e => isDragging && movePaddle(e));
        document.addEventListener('touchend', () => isDragging = false);

        // Speed update
        function updateSpeed() {
            const newSpeed = baseSpeed + Math.floor(score / 2) * 0.5;
            ballSpeedX = (ballSpeedX >= 0 ? 1 : -1) * newSpeed;
            ballSpeedY = (ballSpeedY >= 0 ? 1 : -1) * newSpeed;
            displays.speed.textContent = `Speed: ${newSpeed.toFixed(1)}`;
        }

        // Game loop
        function loop() {
            ballX += ballSpeedX * speedScale;
            ballY += ballSpeedY * speedScale;
            ball.style.left = `${ballX}px`;
            ball.style.top = `${ballY}px`;

            if (ball.offsetLeft <= 0 || ball.offsetLeft >= 385) ballSpeedX = -ballSpeedX;
            if (ball.offsetTop <= 0) ballSpeedY = -ballSpeedY;
            if (ball.offsetTop >= 585) {
                ballX = 192.5;
                ballY = 20;
                ballSpeedX = Math.random() * 4 - 2;
                ballSpeedY = baseSpeed;
                score = 0;
                updateSpeed();
                displays.score.textContent = `Score: ${score}`;
            }

            if (
                ball.offsetTop >= 570 &&
                ball.offsetLeft + 15 > paddle.offsetLeft &&
                ball.offsetLeft < paddle.offsetLeft + 80 &&
                ballSpeedY > 0
            ) {
                ballSpeedY = -ballSpeedY;
                score++;
                if (score > highScore) {
                    highScore = score;
                    document.cookie = `highScore=${highScore};max-age=${365*24*60*60};path=/`;
                    displays.high.textContent = `High Score: ${highScore}`;
                }
                updateSpeed();
                displays.score.textContent = `Score: ${score}`;
            }

            requestAnimationFrame(loop);
        }

        loop();
    </script>
</body>
</html>